jQuery(function($){"use strict";var wc_payex_checkout={init:function(e){if(this.form=e,this.form_submit=!1,$(this.form).on("click","#place_order",this.onSubmit).on("submit checkout_place_order_payex_checkout"),$(document.body).on("checkout_error",this.resetCheckout),$(document.body).on("updated_checkout",this.onUpdatedCheckout),$(document.body).on("blur",this.onUpdatedCheckout),WC_Gateway_PayEx_Checkout.instant_checkout)if(console.log("Initialization of Instant Checkout..."),wc_payex_checkout.hideAddressFields(),$("#payex-consumer-profile").length>0){let e=$("#payex-consumer-profile").data("reference");wc_payex_checkout.onTokenCreated(e)}else wc_payex_checkout.waitForLoading("payex.hostedView.consumer",function(e){e?console.warn(e):window.payex.hostedView.consumer({container:"payex-checkin",culture:WC_Gateway_PayEx_Checkout.culture,onConsumerIdentified:function(e){console.log("hostedView: onConsumerIdentified"),wc_payex_checkout.onConsumerIdentified(e)},onBillingDetailsAvailable:function(e){wc_payex_checkout.onAddressDetailsAvailable("billing",e)},onShippingDetailsAvailable:function(e){wc_payex_checkout.onAddressDetailsAvailable("shipping",e)},onError:function(e){console.warn(e),alert(e.details)}}).open()})},isPaymentMethodChosen:function(){return $("#payment_method_payex_checkout").is(":checked")},hasToken:function(){return 0<$("input.payex_customer_reference").length},block:function(){1!==wc_payex_checkout.form.data()["blockUI.isBlocked"]&&wc_payex_checkout.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){wc_payex_checkout.form.unblock()},onClose:function(){wc_payex_checkout.unblock()},onReady:function(){console.log("Ready")},onUpdatedCheckout:function(){return!wc_payex_checkout.form.is(".processing")&&(!!WC_Gateway_PayEx_Checkout.instant_checkout&&(console.log("onUpdatedCheckout"),$(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_payex_checkout.form.addClass("processing"),wc_payex_checkout.block(),void wc_payex_checkout.updateOrder().always(function(e){wc_payex_checkout.form.removeClass("processing"),wc_payex_checkout.unblock()}).fail(function(e,o){console.log("updateOrder error:"+o),wc_payex_checkout.onError(o)}).done(function(e){if(console.log(e),"success"!==e.result)return!0===e.result.reload?void window.location.reload():(!0===e.result.refresh&&$(document.body).trigger("update_checkout"),void wc_payex_checkout.onError(e.messages));wc_payex_checkout.loadJs(e.js_url,function(){$("#payment-payex-checkout iframe").remove(),WC_Gateway_PayEx_Checkout.instant_checkout&&($("#payment").hide(),wc_payex_checkout.initPaymentMenu("payment-payex-checkout"))})})))},onSubmit:function(e){return!!wc_payex_checkout.form_submit||(!wc_payex_checkout.isPaymentMethodChosen()||(void 0!==e&&e.preventDefault(),!!wc_payex_checkout.validateForm()&&(console.log("onSubmit"),!wc_payex_checkout.form.is(".processing")&&($(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_payex_checkout.form.addClass("processing"),wc_payex_checkout.block(),wc_payex_checkout.placeOrder().always(function(e){wc_payex_checkout.form.removeClass("processing"),wc_payex_checkout.unblock()}).fail(function(e,o){wc_payex_checkout.onError(o)}).done(function(e){if(console.log(e),"success"!==e.result)return!0===e.result.reload?void window.location.reload():(!0===e.result.refresh&&$(document.body).trigger("update_checkout"),void wc_payex_checkout.onError(e.messages));wc_payex_checkout.loadJs(e.js_url,function(){$("#payment-payex-checkout iframe").remove(),WC_Gateway_PayEx_Checkout.instant_checkout?($("#payment").hide(),wc_payex_checkout.initPaymentMenu("payment-payex-checkout")):$.featherlight('<div id="payex-paymentmenu">&nbsp;</div>',{variant:"featherlight-payex",persist:!0,closeOnClick:!1,closeOnEsc:!1,afterOpen:function(){wc_payex_checkout.initPaymentMenu("payex-paymentmenu")},afterClose:function(){wc_payex_checkout.form.removeClass("processing").unblock()}})})}),!1))))},onTokenCreated:function(e){console.log("onTokenCreated",e),$("#change-shipping-info").show(),wc_payex_checkout.form.append("<input type='hidden' class='payex_customer_reference' name='payex_customer_reference' value='"+e+"'/>"),wc_payex_checkout.onSubmit()},resetCheckout:function(){wc_payex_checkout.form_submit=!1},validateForm:function(){var e,o=!0;return(e=$("#ship-to-different-address-checkbox").is(":checked")?$(".woocommerce-billing-fields .validate-required, .woocommerce-shipping-fields .validate-required").find("input, select").not($("#account_password, #account_username")):$(".woocommerce-billing-fields .validate-required").find("input, select").not($("#account_password, #account_username"))).length&&e.each(function(){var e=$(this),c=e.closest(".form-row"),t=c.is(".validate-required"),n=c.is(".validate-email");(t&&("checkbox"!==e.attr("type")||e.is(":checked")?""===e.val()&&(o=!1):o=!1),n)&&(e.val()&&(new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i).test(e.val())||(o=!1)))}),o},waitForLoading:function(var_string,callback){try{var obj=eval(var_string)}catch(e){return void callback(e)}let attempts=0,timer=window.setInterval(function(){void 0!==obj?(window.clearInterval(timer),callback(null,obj)):++attempts>=120&&(window.clearInterval(timer),callback("Timeout"))},500)},loadJs:function(e,o){console.log("Loading of "+e);let c=document.createElement("script");c.setAttribute("src",e),c.setAttribute("type","text/javascript"),c.setAttribute("async",""),c.addEventListener("load",function(){console.log("Loaded: "+e),o()},!1);let t=document.getElementsByTagName("head")[0];return t&&t.appendChild(c),c},initPaymentMenu:function(e){console.log("initPaymentMenu"),window.payex.hostedView.paymentMenu({container:e,culture:WC_Gateway_PayEx_Checkout.culture,onPaymentCreated:function(){console.log("onPaymentCreated")},onPaymentCompleted:function(e){console.log("onPaymentCompleted"),console.log(e),self.location.href=e.redirectUrl},onPaymentFailed:function(e){console.log("onPaymentFailed"),console.log(e)},onError:function(){}}).open()},refreshPaymentMenu:function(){console.log("refreshPaymentMenu"),window.payex.hostedView.paymentMenu.refresh()},placeOrder:function(){console.log("placeOrder");let e=$(".woocommerce-checkout").serialize();return $.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_place_order",nonce:WC_Gateway_PayEx_Checkout.nonce,data:e},dataType:"json"})},updateOrder:function(){console.log("updateOrder");let e=$(".woocommerce-checkout").serialize();return $.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_update_order",nonce:WC_Gateway_PayEx_Checkout.nonce,data:e},dataType:"json"})},onConsumerIdentified:function(e){return console.log("onConsumerIdentified",e),$("#change-shipping-info").show(),$.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_checkout_customer_profile",nonce:WC_Gateway_PayEx_Checkout.nonce,consumerProfileRef:e.consumerProfileRef},dataType:"json"}).always(function(e){}).done(function(o){console.log(o),o.success?wc_payex_checkout.onTokenCreated(e.consumerProfileRef):alert(o.data.message)})},onAddressDetailsAvailable:function(e,o){return console.log("onAddressDetailsAvailable",e,o),$("#change-shipping-info").show(),$.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_checkout_get_address",nonce:WC_Gateway_PayEx_Checkout.nonce,type:e,url:o.url},dataType:"json"}).always(function(e){}).done(function(o){if(console.log(o),!o.success)return void alert(o.data.message);let c=o.data;$.each(c,function(o,c){[e].forEach(function(e){let t=$('input[name="'+e+"_"+o+'"]');if(0!==t.length&&(t.prop("readonly",!1),t.closest(".form-row").removeClass("payex-locked"),t.val(c).change(),"country"===o||"state"===o)){let t=$("#"+e+"_"+o);void 0!==window.Select2?t.select2("val",c):void 0!==$.fn.chosen?t.val(c).trigger("chosen:updated"):t.change()}})}),$(document.body).trigger("update_checkout")})},onError:function(e){console.log("onError",e)},submit_error:function(e){$(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_payex_checkout.form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),wc_payex_checkout.form.removeClass("processing").unblock(),wc_payex_checkout.form.find(".input-text, select, input:checkbox").trigger("validate").blur(),wc_payex_checkout.scroll_to_notices(),$(document.body).trigger("checkout_error")},scroll_to_notices:function(){let e=$(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");e.length||(e=$(".form.checkout")),$.scroll_to_notices(e)},hideAddressFields:function(){$(".woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields").hide()},showAddressFields:function(){$(".woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields").show()}};$(document).ready(function(){wc_payex_checkout.init($("form.checkout, form#order_review, form#add_payment_method")),$("#change-shipping-info").on("click",function(){$("#change-shipping-info").hide(),wc_payex_checkout.showAddressFields()})})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoZWNrb3V0LmpzIl0sIm5hbWVzIjpbImpRdWVyeSIsIiQiLCJ3Y19wYXlleF9jaGVja291dCIsImluaXQiLCJmb3JtIiwidGhpcyIsImZvcm1fc3VibWl0Iiwib24iLCJvblN1Ym1pdCIsImRvY3VtZW50IiwiYm9keSIsInJlc2V0Q2hlY2tvdXQiLCJvblVwZGF0ZWRDaGVja291dCIsIldDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQiLCJpbnN0YW50X2NoZWNrb3V0IiwiY29uc29sZSIsImxvZyIsImhpZGVBZGRyZXNzRmllbGRzIiwibGVuZ3RoIiwicmVmZXJlbmNlIiwiZGF0YSIsIm9uVG9rZW5DcmVhdGVkIiwid2FpdEZvckxvYWRpbmciLCJlcnIiLCJ3YXJuIiwid2luZG93IiwicGF5ZXgiLCJob3N0ZWRWaWV3IiwiY29uc3VtZXIiLCJjb250YWluZXIiLCJjdWx0dXJlIiwib25Db25zdW1lcklkZW50aWZpZWQiLCJvbkJpbGxpbmdEZXRhaWxzQXZhaWxhYmxlIiwib25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZSIsIm9uU2hpcHBpbmdEZXRhaWxzQXZhaWxhYmxlIiwib25FcnJvciIsImFsZXJ0IiwiZGV0YWlscyIsIm9wZW4iLCJpc1BheW1lbnRNZXRob2RDaG9zZW4iLCJpcyIsImhhc1Rva2VuIiwiYmxvY2siLCJtZXNzYWdlIiwib3ZlcmxheUNTUyIsImJhY2tncm91bmQiLCJvcGFjaXR5IiwidW5ibG9jayIsIm9uQ2xvc2UiLCJvblJlYWR5IiwicmVtb3ZlIiwiYWRkQ2xhc3MiLCJ1cGRhdGVPcmRlciIsImFsd2F5cyIsInJlc3BvbnNlIiwicmVtb3ZlQ2xhc3MiLCJmYWlsIiwianFYSFIiLCJ0ZXh0U3RhdHVzIiwiZG9uZSIsInJlc3VsdCIsInJlbG9hZCIsImxvY2F0aW9uIiwicmVmcmVzaCIsInRyaWdnZXIiLCJtZXNzYWdlcyIsImxvYWRKcyIsImhpZGUiLCJpbml0UGF5bWVudE1lbnUiLCJlIiwicHJldmVudERlZmF1bHQiLCJ2YWxpZGF0ZUZvcm0iLCJwbGFjZU9yZGVyIiwiZmVhdGhlcmxpZ2h0IiwidmFyaWFudCIsInBlcnNpc3QiLCJjbG9zZU9uQ2xpY2siLCJjbG9zZU9uRXNjIiwiYWZ0ZXJPcGVuIiwiYWZ0ZXJDbG9zZSIsInNob3ciLCJhcHBlbmQiLCIkcmVxdWlyZWRfaW5wdXRzIiwidmFsaWRhdGVkIiwiZmluZCIsIm5vdCIsImVhY2giLCIkdGhpcyIsIiRwYXJlbnQiLCJjbG9zZXN0IiwidmFsaWRhdGVfcmVxdWlyZWQiLCJ2YWxpZGF0ZV9lbWFpbCIsImF0dHIiLCJ2YWwiLCJSZWdFeHAiLCJ0ZXN0IiwidmFyX3N0cmluZyIsImNhbGxiYWNrIiwib2JqIiwiZXZhbCIsImF0dGVtcHRzIiwidGltZXIiLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJqcyIsInNjcmlwdCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJhZGRFdmVudExpc3RlbmVyIiwib0hlYWQiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImFwcGVuZENoaWxkIiwiaWQiLCJwYXltZW50TWVudSIsIm9uUGF5bWVudENyZWF0ZWQiLCJvblBheW1lbnRDb21wbGV0ZWQiLCJzZWxmIiwiaHJlZiIsInJlZGlyZWN0VXJsIiwib25QYXltZW50RmFpbGVkIiwicmVmcmVzaFBheW1lbnRNZW51IiwiZmllbGRzIiwic2VyaWFsaXplIiwiYWpheCIsInR5cGUiLCJ1cmwiLCJhamF4X3VybCIsImFjdGlvbiIsIm5vbmNlIiwiZGF0YVR5cGUiLCJjb25zdW1lclByb2ZpbGVSZWYiLCJzdWNjZXNzIiwia2V5IiwidmFsdWUiLCJmb3JFYWNoIiwic2VjdGlvbiIsImVsIiwicHJvcCIsImNoYW5nZSIsImVsMSIsIlNlbGVjdDIiLCJzZWxlY3QyIiwiZm4iLCJjaG9zZW4iLCJzdWJtaXRfZXJyb3IiLCJlcnJvcl9tZXNzYWdlIiwicHJlcGVuZCIsImJsdXIiLCJzY3JvbGxfdG9fbm90aWNlcyIsInNjcm9sbEVsZW1lbnQiLCJzaG93QWRkcmVzc0ZpZWxkcyIs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R0FBNkIsVUFBUkEsR0FBaUIsQ0FDdEMsSUFBSU8sRUFBTTFJLEVBQUUsSUFBTXNJLEVBQVUsSUFBTUgsUUFDSixJQUFuQjNHLE9BQU9tSCxRQUNkRCxFQUFJRSxRQUFRLE1BQU9SLFFBQ1csSUFBaEJwSSxFQUFFNkksR0FBR0MsT0FFbkJKLEVBQUk5QyxJQUFJd0MsR0FBT3JFLFFBQVEsa0JBR3ZCMkUsRUFBSUQsY0FNcEJ6SSxFQUFHUSxTQUFTQyxNQUFPc0QsUUFBUyxzQkFJcEM3QixRQUFTLFNBQVdmLEdBQ2hCTCxRQUFRQyxJQUFLLFVBQVdJLElBRzVCNEgsYUFBYyxTQUFVQyxHQUNwQmhKLEVBQUcsK0VBQWdGaUQsU0FDbkZoRCxrQkFBa0JFLEtBQUs4SSxRQUFTLHlFQUEyRUQsRUFBZ0IsVUFDM0gvSSxrQkFBa0JFLEtBQUttRCxZQUFhLGNBQWVSLFVBQ25EN0Msa0JBQWtCRSxLQUFLZ0YsS0FBTSx1Q0FBd0NwQixRQUFTLFlBQWFtRixPQUMzRmpKLGtCQUFrQmtKLG9CQUNsQm5KLEVBQUdRLFNBQVNDLE1BQU9zRCxRQUFTLG1CQUVoQ29GLGtCQUFtQixXQUNmLElBQUlDLEVBQWdCcEosRUFBRyxpRkFDaEJvSixFQUFjbkksU0FDakJtSSxFQUFnQnBKLEVBQUcsbUJBR3ZCQSxFQUFFbUosa0JBQW1CQyxJQUV6QnBJLGtCQUFtQixXQUNmaEIsRUFBRSw0RUFBNEVrRSxRQUVsRm1GLGtCQUFtQixXQUNmckosRUFBRSw0RUFBNEUrRSxTQUl0Ri9FLEVBQUVRLFVBQVU4SSxNQUFNLFdBQ2RySixrQkFBa0JDLEtBQU1GLEVBQUcsOERBRTNCQSxFQUFHLHlCQUEwQk0sR0FBSSxRQUFTLFdBQ3RDTixFQUFHLHlCQUEwQmtFLE9BQzdCakUsa0JBQWtCb0oiLCJmaWxlIjoiY2hlY2tvdXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIHdjX2NoZWNrb3V0X3BhcmFtcyAqL1xualF1ZXJ5KCBmdW5jdGlvbiggJCApIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBPYmplY3QgdG8gaGFuZGxlIFBheUV4IGNoZWNrb3V0IHBheW1lbnQgZm9ybXMuXG4gICAgICovXG4gICAgdmFyIHdjX3BheWV4X2NoZWNrb3V0ID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhbGl6ZSBlIGhhbmRsZXJzIGFuZCBVSSBzdGF0ZS5cbiAgICAgICAgICovXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBmb3JtICkge1xuICAgICAgICAgICAgdGhpcy5mb3JtICAgICAgICAgPSBmb3JtO1xuICAgICAgICAgICAgdGhpcy5mb3JtX3N1Ym1pdCAgPSBmYWxzZTtcblxuICAgICAgICAgICAgJCggdGhpcy5mb3JtIClcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gYmluZCBkaXJlY3RseSB0byB0aGUgY2xpY2sgKGFuZCBub3QgY2hlY2tvdXRfcGxhY2Vfb3JkZXJfcGF5ZXhfY2hlY2tvdXQpIHRvIGF2b2lkIHBvcHVwIGJsb2NrZXJzXG4gICAgICAgICAgICAvLyBlc3BlY2lhbGx5IG9uIG1vYmlsZSBkZXZpY2VzIChsaWtlIG9uIENocm9tZSBmb3IgaU9TKSBmcm9tIGJsb2NraW5nIHBheWV4X2NoZWNrb3V0KHBheW1lbnRfaWQsIHt9LCAnb3BlbicpOyBmcm9tIG9wZW5pbmcgYSB0YWJcbiAgICAgICAgICAgICAgICAub24oICdjbGljaycsICcjcGxhY2Vfb3JkZXInLCB0aGlzLm9uU3VibWl0IClcblxuICAgICAgICAgICAgICAgIC8vIFdvb0NvbW1lcmNlIGxldHMgdXMgcmV0dXJuIGEgZmFsc2Ugb24gY2hlY2tvdXRfcGxhY2Vfb3JkZXJfe2dhdGV3YXl9IHRvIGtlZXAgdGhlIGZvcm0gZnJvbSBzdWJtaXR0aW5nXG4gICAgICAgICAgICAgICAgLm9uKCAnc3VibWl0IGNoZWNrb3V0X3BsYWNlX29yZGVyX3BheWV4X2NoZWNrb3V0JyApO1xuXG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkub24oICdjaGVja291dF9lcnJvcicsIHRoaXMucmVzZXRDaGVja291dCApO1xuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLm9uKCAndXBkYXRlZF9jaGVja291dCcsIHRoaXMub25VcGRhdGVkQ2hlY2tvdXQgKTtcbiAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS5vbiggJ2JsdXInLCB0aGlzLm9uVXBkYXRlZENoZWNrb3V0ICk7XG5cbiAgICAgICAgICAgIGlmICggV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5pbnN0YW50X2NoZWNrb3V0ICkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnSW5pdGlhbGl6YXRpb24gb2YgSW5zdGFudCBDaGVja291dC4uLicgKTtcbiAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5oaWRlQWRkcmVzc0ZpZWxkcygpO1xuICAgICAgICAgICAgICAgIGlmICggJCgnI3BheWV4LWNvbnN1bWVyLXByb2ZpbGUnKS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmVmZXJlbmNlID0gJCgnI3BheWV4LWNvbnN1bWVyLXByb2ZpbGUnKS5kYXRhKCAncmVmZXJlbmNlJyApO1xuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vblRva2VuQ3JlYXRlZCggcmVmZXJlbmNlICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQud2FpdEZvckxvYWRpbmcoJ3BheWV4Lmhvc3RlZFZpZXcuY29uc3VtZXInLCBmdW5jdGlvbiAoIGVyciApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZXJyICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybiggZXJyICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJbml0IFBheUV4IGhvc3RlZFZpZXdcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wYXlleC5ob3N0ZWRWaWV3LmNvbnN1bWVyKCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiAncGF5ZXgtY2hlY2tpbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VsdHVyZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5jdWx0dXJlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ29uc3VtZXJJZGVudGlmaWVkOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdob3N0ZWRWaWV3OiBvbkNvbnN1bWVySWRlbnRpZmllZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQub25Db25zdW1lcklkZW50aWZpZWQoIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQmlsbGluZ0RldGFpbHNBdmFpbGFibGU6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vbkFkZHJlc3NEZXRhaWxzQXZhaWxhYmxlKCAnYmlsbGluZycsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU2hpcHBpbmdEZXRhaWxzQXZhaWxhYmxlOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQub25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZSggJ3NoaXBwaW5nJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25FcnJvcjogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIGRhdGEuZGV0YWlscyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3djX3BheWV4X2NoZWNrb3V0Lm9uRXJyb3IoIGRhdGEuZGV0YWlscyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gKS5vcGVuKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpc1BheW1lbnRNZXRob2RDaG9zZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICQoICcjcGF5bWVudF9tZXRob2RfcGF5ZXhfY2hlY2tvdXQnICkuaXMoICc6Y2hlY2tlZCcgKTtcbiAgICAgICAgfSxcblxuICAgICAgICBoYXNUb2tlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gMCA8ICQoICdpbnB1dC5wYXlleF9jdXN0b21lcl9yZWZlcmVuY2UnICkubGVuZ3RoO1xuICAgICAgICB9LFxuXG4gICAgICAgIGJsb2NrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCBmb3JtX2RhdGEgPSB3Y19wYXlleF9jaGVja291dC5mb3JtLmRhdGEoKTtcbiAgICAgICAgICAgIGlmICggMSAhPT0gZm9ybV9kYXRhWydibG9ja1VJLmlzQmxvY2tlZCddICkge1xuICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0uYmxvY2soe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBvdmVybGF5Q1NTOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAnI2ZmZicsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjZcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVuYmxvY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS51bmJsb2NrKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25DbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC51bmJsb2NrKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ1JlYWR5JyApO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uVXBkYXRlZENoZWNrb3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICggd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5pcyggJy5wcm9jZXNzaW5nJyApICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCAhIFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQuaW5zdGFudF9jaGVja291dCApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25VcGRhdGVkQ2hlY2tvdXQnICk7XG4gICAgICAgICAgICAkKCAnLndvb2NvbW1lcmNlLU5vdGljZUdyb3VwLWNoZWNrb3V0LCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1tZXNzYWdlJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5hZGRDbGFzcyggJ3Byb2Nlc3NpbmcnICk7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5ibG9jaygpO1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQudXBkYXRlT3JkZXIoKVxuICAgICAgICAgICAgICAgIC5hbHdheXMoIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0ucmVtb3ZlQ2xhc3MoICdwcm9jZXNzaW5nJyApO1xuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC51bmJsb2NrKCk7XG4gICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgLmZhaWwoIGZ1bmN0aW9uKCBqcVhIUiwgdGV4dFN0YXR1cyApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICd1cGRhdGVPcmRlciBlcnJvcjonICsgdGV4dFN0YXR1cyApO1xuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vbkVycm9yKCB0ZXh0U3RhdHVzICk7XG4gICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIHJlc3BvbnNlICk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZXN1bHQgIT09ICdzdWNjZXNzJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVsb2FkIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdHJ1ZSA9PT0gcmVzcG9uc2UucmVzdWx0LnJlbG9hZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUcmlnZ2VyIHVwZGF0ZSBpbiBjYXNlIHdlIG5lZWQgYSBmcmVzaCBub25jZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0cnVlID09PSByZXNwb25zZS5yZXN1bHQucmVmcmVzaCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkudHJpZ2dlciggJ3VwZGF0ZV9jaGVja291dCcgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQub25FcnJvciggcmVzcG9uc2UubWVzc2FnZXMgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIEB0b2RvIFJlZnJlc2hcbiAgICAgICAgICAgICAgICAgICAgLy93Y19wYXlleF9jaGVja291dC5yZWZyZXNoUGF5bWVudE1lbnUoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBMb2FkIFBheUV4IENoZWNrb3V0IGZyYW1lXG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmxvYWRKcyggcmVzcG9uc2VbJ2pzX3VybCddLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGF5bWVudC1wYXlleC1jaGVja291dCBpZnJhbWUnKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9hZCBQYXlFeCBDaGVja291dCBmcmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0Lmluc3RhbnRfY2hlY2tvdXQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3BheW1lbnQnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdFBheW1lbnRNZW51KCdwYXltZW50LXBheWV4LWNoZWNrb3V0JyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uU3VibWl0OiBmdW5jdGlvbiggZSApIHtcbiAgICAgICAgICAgIGlmICggd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybV9zdWJtaXQgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggd2NfcGF5ZXhfY2hlY2tvdXQuaXNQYXltZW50TWV0aG9kQ2hvc2VuKCkgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgZSAhPT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoICEgd2NfcGF5ZXhfY2hlY2tvdXQudmFsaWRhdGVGb3JtKCkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uU3VibWl0JyApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCB3Y19wYXlleF9jaGVja291dC5mb3JtLmlzKCAnLnByb2Nlc3NpbmcnICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkKCAnLndvb2NvbW1lcmNlLU5vdGljZUdyb3VwLWNoZWNrb3V0LCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1tZXNzYWdlJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0uYWRkQ2xhc3MoICdwcm9jZXNzaW5nJyApO1xuICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmJsb2NrKCk7XG4gICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQucGxhY2VPcmRlcigpXG4gICAgICAgICAgICAgICAgICAgIC5hbHdheXMoIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5mb3JtLnJlbW92ZUNsYXNzKCAncHJvY2Vzc2luZycgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LnVuYmxvY2soKTtcbiAgICAgICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgICAgIC5mYWlsKCBmdW5jdGlvbigganFYSFIsIHRleHRTdGF0dXMgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vbkVycm9yKCB0ZXh0U3RhdHVzICk7XG4gICAgICAgICAgICAgICAgICAgIH0gKVxuICAgICAgICAgICAgICAgICAgICAuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIHJlc3BvbnNlICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UucmVzdWx0ICE9PSAnc3VjY2VzcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWxvYWQgcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdHJ1ZSA9PT0gcmVzcG9uc2UucmVzdWx0LnJlbG9hZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJpZ2dlciB1cGRhdGUgaW4gY2FzZSB3ZSBuZWVkIGEgZnJlc2ggbm9uY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHRydWUgPT09IHJlc3BvbnNlLnJlc3VsdC5yZWZyZXNoICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkudHJpZ2dlciggJ3VwZGF0ZV9jaGVja291dCcgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vbkVycm9yKCByZXNwb25zZS5tZXNzYWdlcyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9hZCBQYXlFeCBDaGVja291dCBmcmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQubG9hZEpzKCByZXNwb25zZVsnanNfdXJsJ10sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGF5bWVudC1wYXlleC1jaGVja291dCBpZnJhbWUnKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5pbnN0YW50X2NoZWNrb3V0ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGF5bWVudCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdFBheW1lbnRNZW51KCdwYXltZW50LXBheWV4LWNoZWNrb3V0JyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZmVhdGhlcmxpZ2h0KCc8ZGl2IGlkPVwicGF5ZXgtcGF5bWVudG1lbnVcIj4mbmJzcDs8L2Rpdj4nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50OiAnZmVhdGhlcmxpZ2h0LXBheWV4JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcnNpc3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9uQ2xpY2s6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VPbkVzYzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5pbml0UGF5bWVudE1lbnUoJ3BheWV4LXBheW1lbnRtZW51JyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5mb3JtLnJlbW92ZUNsYXNzKCAncHJvY2Vzc2luZycgKS51bmJsb2NrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblRva2VuQ3JlYXRlZDogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uVG9rZW5DcmVhdGVkJywgZGF0YSApO1xuXG4gICAgICAgICAgICAvL3djX3BheWV4X2NoZWNrb3V0LnNob3dBZGRyZXNzRmllbGRzKCk7XG4gICAgICAgICAgICAkKCAnI2NoYW5nZS1zaGlwcGluZy1pbmZvJyApLnNob3coKTtcblxuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5hcHBlbmQoIFwiPGlucHV0IHR5cGU9J2hpZGRlbicgY2xhc3M9J3BheWV4X2N1c3RvbWVyX3JlZmVyZW5jZScgbmFtZT0ncGF5ZXhfY3VzdG9tZXJfcmVmZXJlbmNlJyB2YWx1ZT0nXCIgKyBkYXRhICsgXCInLz5cIiApO1xuICAgICAgICAgICAgLy93Y19wYXlleF9jaGVja291dC5mb3JtLnN1Ym1pdCgpO1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQub25TdWJtaXQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZXNldENoZWNrb3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm1fc3VibWl0ID0gZmFsc2U7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsaWRhdGVGb3JtOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgJHJlcXVpcmVkX2lucHV0cyxcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgd2UgbmVlZCB0byB2YWxpZGF0ZSBzaGlwcGluZyBhZGRyZXNzXG4gICAgICAgICAgICBpZiAoICQoICcjc2hpcC10by1kaWZmZXJlbnQtYWRkcmVzcy1jaGVja2JveCcgKS5pcyggJzpjaGVja2VkJyApICkge1xuICAgICAgICAgICAgICAgICRyZXF1aXJlZF9pbnB1dHMgPSAkKCAnLndvb2NvbW1lcmNlLWJpbGxpbmctZmllbGRzIC52YWxpZGF0ZS1yZXF1aXJlZCwgLndvb2NvbW1lcmNlLXNoaXBwaW5nLWZpZWxkcyAudmFsaWRhdGUtcmVxdWlyZWQnICkuZmluZCgnaW5wdXQsIHNlbGVjdCcpLm5vdCggJCggJyNhY2NvdW50X3Bhc3N3b3JkLCAjYWNjb3VudF91c2VybmFtZScgKSApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkcmVxdWlyZWRfaW5wdXRzID0gJCggJy53b29jb21tZXJjZS1iaWxsaW5nLWZpZWxkcyAudmFsaWRhdGUtcmVxdWlyZWQnICkuZmluZCgnaW5wdXQsIHNlbGVjdCcpLm5vdCggJCggJyNhY2NvdW50X3Bhc3N3b3JkLCAjYWNjb3VudF91c2VybmFtZScgKSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoICRyZXF1aXJlZF9pbnB1dHMubGVuZ3RoICkge1xuICAgICAgICAgICAgICAgICRyZXF1aXJlZF9pbnB1dHMuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQoIHRoaXMgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICRwYXJlbnQgICAgICAgICAgID0gJHRoaXMuY2xvc2VzdCggJy5mb3JtLXJvdycgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlX3JlcXVpcmVkID0gJHBhcmVudC5pcyggJy52YWxpZGF0ZS1yZXF1aXJlZCcgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlX2VtYWlsICAgID0gJHBhcmVudC5pcyggJy52YWxpZGF0ZS1lbWFpbCcgKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIHZhbGlkYXRlX3JlcXVpcmVkICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAnY2hlY2tib3gnID09PSAkdGhpcy5hdHRyKCAndHlwZScgKSAmJiAhICR0aGlzLmlzKCAnOmNoZWNrZWQnICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCAkdGhpcy52YWwoKSA9PT0gJycgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIHZhbGlkYXRlX2VtYWlsICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkdGhpcy52YWwoKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yODU1ODY1L2pxdWVyeS12YWxpZGF0ZS1lLW1haWwtYWRkcmVzcy1yZWdleCAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXR0ZXJuID0gbmV3IFJlZ0V4cCgvXigoKFthLXpdfFxcZHxbISNcXCQlJidcXCpcXCtcXC1cXC89XFw/XFxeX2B7XFx8fX5dfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSsoXFwuKFthLXpdfFxcZHxbISNcXCQlJidcXCpcXCtcXC1cXC89XFw/XFxeX2B7XFx8fX5dfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSspKil8KChcXHgyMikoKCgoXFx4MjB8XFx4MDkpKihcXHgwZFxceDBhKSk/KFxceDIwfFxceDA5KSspPygoW1xceDAxLVxceDA4XFx4MGJcXHgwY1xceDBlLVxceDFmXFx4N2ZdfFxceDIxfFtcXHgyMy1cXHg1Yl18W1xceDVkLVxceDdlXXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KFxcXFwoW1xceDAxLVxceDA5XFx4MGJcXHgwY1xceDBkLVxceDdmXXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkpKSkqKCgoXFx4MjB8XFx4MDkpKihcXHgwZFxceDBhKSk/KFxceDIwfFxceDA5KSspPyhcXHgyMikpKUAoKChbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCgoW2Etel18XFxkfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKShbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSooW2Etel18XFxkfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSkpXFwuKSsoKFthLXpdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoKFthLXpdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKShbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSooW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKSlcXC4/JC9pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICEgcGF0dGVybi50ZXN0KCAkdGhpcy52YWwoKSAgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB2YWxpZGF0ZWQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgd2FpdEZvckxvYWRpbmc6IGZ1bmN0aW9uICggdmFyX3N0cmluZywgY2FsbGJhY2sgKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSBldmFsKCB2YXJfc3RyaW5nICk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soIGUgKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBhdHRlbXB0cyA9IDA7XG4gICAgICAgICAgICBsZXQgdGltZXIgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIG9iaiAhPT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKCB0aW1lciApO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayggbnVsbCwgb2JqICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYXR0ZW1wdHMrKztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGVtcHRzID49IDEyMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoIHRpbWVyICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayggJ1RpbWVvdXQnICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCA1MDAgKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogTG9hZCBKU1xuICAgICAgICAgKiBAcGFyYW0ganNcbiAgICAgICAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAgICAgICAqL1xuICAgICAgICBsb2FkSnM6IGZ1bmN0aW9uICgganMsIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdMb2FkaW5nIG9mICcgKyBqcyApO1xuICAgICAgICAgICAgLy8gQ3JlYXRlcyBhIG5ldyBzY3JpcHQgdGFnXG4gICAgICAgICAgICBsZXQgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NjcmlwdCcgKTtcblxuICAgICAgICAgICAgLy8gU2V0IHNjcmlwdCB0YWcgcGFyYW1zXG4gICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCAnc3JjJywganMgKTtcbiAgICAgICAgICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoICd0eXBlJywgJ3RleHQvamF2YXNjcmlwdCcgKTtcbiAgICAgICAgICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoICdhc3luYycsICcnICk7XG4gICAgICAgICAgICBzY3JpcHQuYWRkRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdMb2FkZWQ6ICcgKyBqcyApO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9LCBmYWxzZSApO1xuXG4gICAgICAgICAgICAvLyBHZXRzIGRvY3VtZW50IGhlYWQgZWxlbWVudFxuICAgICAgICAgICAgbGV0IG9IZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICdoZWFkJyApWzBdO1xuICAgICAgICAgICAgaWYgKCBvSGVhZCApIHtcbiAgICAgICAgICAgICAgICAvLyBBZGQgc2NyaXB0IHRhZyB0byBoZWFkXG4gICAgICAgICAgICAgICAgb0hlYWQuYXBwZW5kQ2hpbGQoIHNjcmlwdCApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc2NyaXB0O1xuICAgICAgICB9LFxuXG4gICAgICAgIGluaXRQYXltZW50TWVudTogZnVuY3Rpb24gKCBpZCApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnaW5pdFBheW1lbnRNZW51JyApO1xuICAgICAgICAgICAgLy8gTG9hZCBQYXlFeCBDaGVja291dCBmcmFtZVxuICAgICAgICAgICAgd2luZG93LnBheWV4Lmhvc3RlZFZpZXcucGF5bWVudE1lbnUoIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IGlkLFxuICAgICAgICAgICAgICAgIGN1bHR1cmU6IFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQuY3VsdHVyZSxcbiAgICAgICAgICAgICAgICBvblBheW1lbnRDcmVhdGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25QYXltZW50Q3JlYXRlZCcgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudENvbXBsZXRlZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudENvbXBsZXRlZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2NhdGlvbi5ocmVmID0gZGF0YS5yZWRpcmVjdFVybDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudEZhaWxlZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudEZhaWxlZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgLy9zZWxmLmxvY2F0aW9uLmhyZWYgPSBkYXRhLnJlZGlyZWN0VXJsO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25FcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKS5vcGVuKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlZnJlc2hcbiAgICAgICAgICovXG4gICAgICAgIHJlZnJlc2hQYXltZW50TWVudTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ3JlZnJlc2hQYXltZW50TWVudScgKTtcbiAgICAgICAgICAgIHdpbmRvdy5wYXlleC5ob3N0ZWRWaWV3LnBheW1lbnRNZW51LnJlZnJlc2goKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwbGFjZU9yZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ3BsYWNlT3JkZXInICk7XG4gICAgICAgICAgICBsZXQgZmllbGRzID0gJCgnLndvb2NvbW1lcmNlLWNoZWNrb3V0Jykuc2VyaWFsaXplKCk7XG5cbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0LmFqYXhfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncGF5ZXhfcGxhY2Vfb3JkZXInLFxuICAgICAgICAgICAgICAgICAgICBub25jZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5ub25jZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZmllbGRzXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdXBkYXRlT3JkZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAndXBkYXRlT3JkZXInICk7XG4gICAgICAgICAgICBsZXQgZmllbGRzID0gJCgnLndvb2NvbW1lcmNlLWNoZWNrb3V0Jykuc2VyaWFsaXplKCk7XG5cbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0LmFqYXhfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncGF5ZXhfdXBkYXRlX29yZGVyJyxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQubm9uY2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGZpZWxkc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ29uc3VtZXJJZGVudGlmaWVkOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uQ29uc3VtZXJJZGVudGlmaWVkJywgZGF0YSApO1xuICAgICAgICAgICAgJCggJyNjaGFuZ2Utc2hpcHBpbmctaW5mbycgKS5zaG93KCk7XG5cbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0LmFqYXhfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncGF5ZXhfY2hlY2tvdXRfY3VzdG9tZXJfcHJvZmlsZScsXG4gICAgICAgICAgICAgICAgICAgIG5vbmNlOiBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0Lm5vbmNlLFxuICAgICAgICAgICAgICAgICAgICBjb25zdW1lclByb2ZpbGVSZWY6IGRhdGEuY29uc3VtZXJQcm9maWxlUmVmXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICkuYWx3YXlzKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICB9ICkuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBjaGVja291dCBmaWVsZFxuICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0Lm9uVG9rZW5DcmVhdGVkKCBkYXRhLmNvbnN1bWVyUHJvZmlsZVJlZiApO1xuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuICAgICAgICBvbkFkZHJlc3NEZXRhaWxzQXZhaWxhYmxlOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZScsIHR5cGUsIGRhdGEgKTtcblxuICAgICAgICAgICAgJCggJyNjaGFuZ2Utc2hpcHBpbmctaW5mbycgKS5zaG93KCk7XG5cbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0LmFqYXhfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncGF5ZXhfY2hlY2tvdXRfZ2V0X2FkZHJlc3MnLFxuICAgICAgICAgICAgICAgICAgICBub25jZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5ub25jZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBkYXRhLnVybFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgfSApLmFsd2F5cyggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgfSApLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGFkZHJlc3NcbiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIFt0eXBlXS5mb3JFYWNoKGZ1bmN0aW9uKHNlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBlbCA9ICQoJ2lucHV0W25hbWU9XCInICsgc2VjdGlvbiArICdfJyArIGtleSArICdcIl0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnByb3AoJ3JlYWRvbmx5JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwuY2xvc2VzdCgnLmZvcm0tcm93JykucmVtb3ZlQ2xhc3MoJ3BheWV4LWxvY2tlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwudmFsKHZhbHVlKS5jaGFuZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ2NvdW50cnknIHx8IGtleSA9PT0gJ3N0YXRlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBlbDEgPSAkKCcjJyArIHNlY3Rpb24gKyAnXycgKyBrZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93LlNlbGVjdDIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsMS5zZWxlY3QyKCd2YWwnLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgJC5mbi5jaG9zZW4gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENob3NlblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbDEudmFsKHZhbHVlKS50cmlnZ2VyKCdjaG9zZW46dXBkYXRlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2VsMS5jaG9zZW4oKS5jaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbDEuY2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS50cmlnZ2VyKCAndXBkYXRlX2NoZWNrb3V0JyApO1xuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25FcnJvcicsIGRhdGEgKTtcbiAgICAgICAgICAgIC8vd2NfcGF5ZXhfY2hlY2tvdXQuc3VibWl0X2Vycm9yKCAnPGRpdiBjbGFzcz1cIndvb2NvbW1lcmNlLWVycm9yXCI+JyArIGRhdGEgKyAnPC9kaXY+JyApO1xuICAgICAgICB9LFxuICAgICAgICBzdWJtaXRfZXJyb3I6IGZ1bmN0aW9uKCBlcnJvcl9tZXNzYWdlICkge1xuICAgICAgICAgICAgJCggJy53b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dCwgLndvb2NvbW1lcmNlLWVycm9yLCAud29vY29tbWVyY2UtbWVzc2FnZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0ucHJlcGVuZCggJzxkaXYgY2xhc3M9XCJ3b29jb21tZXJjZS1Ob3RpY2VHcm91cCB3b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dFwiPicgKyBlcnJvcl9tZXNzYWdlICsgJzwvZGl2PicgKTtcbiAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0ucmVtb3ZlQ2xhc3MoICdwcm9jZXNzaW5nJyApLnVuYmxvY2soKTtcbiAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0uZmluZCggJy5pbnB1dC10ZXh0LCBzZWxlY3QsIGlucHV0OmNoZWNrYm94JyApLnRyaWdnZXIoICd2YWxpZGF0ZScgKS5ibHVyKCk7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5zY3JvbGxfdG9fbm90aWNlcygpO1xuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLnRyaWdnZXIoICdjaGVja291dF9lcnJvcicgKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2Nyb2xsX3RvX25vdGljZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0IHNjcm9sbEVsZW1lbnQgPSAkKCAnLndvb2NvbW1lcmNlLU5vdGljZUdyb3VwLXVwZGF0ZU9yZGVyUmV2aWV3LCAud29vY29tbWVyY2UtTm90aWNlR3JvdXAtY2hlY2tvdXQnICk7XG4gICAgICAgICAgICBpZiAoICEgc2Nyb2xsRWxlbWVudC5sZW5ndGggKSB7XG4gICAgICAgICAgICAgICAgc2Nyb2xsRWxlbWVudCA9ICQoICcuZm9ybS5jaGVja291dCcgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5zY3JvbGxfdG9fbm90aWNlcyggc2Nyb2xsRWxlbWVudCApO1xuICAgICAgICB9LFxuICAgICAgICBoaWRlQWRkcmVzc0ZpZWxkczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCgnLndvb2NvbW1lcmNlLWJpbGxpbmctZmllbGRzX19maWVsZC13cmFwcGVyLCAud29vY29tbWVyY2Utc2hpcHBpbmctZmllbGRzJykuaGlkZSgpO1xuICAgICAgICB9LFxuICAgICAgICBzaG93QWRkcmVzc0ZpZWxkczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCgnLndvb2NvbW1lcmNlLWJpbGxpbmctZmllbGRzX19maWVsZC13cmFwcGVyLCAud29vY29tbWVyY2Utc2hpcHBpbmctZmllbGRzJykuc2hvdygpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdCggJCggXCJmb3JtLmNoZWNrb3V0LCBmb3JtI29yZGVyX3JldmlldywgZm9ybSNhZGRfcGF5bWVudF9tZXRob2RcIiApICk7XG5cbiAgICAgICAgJCggJyNjaGFuZ2Utc2hpcHBpbmctaW5mbycgKS5vbiggJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCggJyNjaGFuZ2Utc2hpcHBpbmctaW5mbycgKS5oaWRlKCk7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5zaG93QWRkcmVzc0ZpZWxkcygpO1xuICAgICAgICB9ICk7XG4gICAgfSk7XG59KTtcblxuIl19
